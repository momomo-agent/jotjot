# JotJot 开发日志

## 2026-02-03 项目启动

### 产品定位
**JotJot = 极速闪念捕捉器**
- 想到就记，记完就走
- Mac + iOS 双端，iCloud 同步

### 品牌人格
- 主：魔法师（变革、奇迹）
- 副：智者（清晰）、照顾者（温暖）

### 核心体验
- Mac：⌘⇧J 快捷键呼出，VSCode 风格编辑
- iOS：打开就写，滑动切换

### 今日进度
- ✅ 项目结构搭建（JotJotKit/Mac/iOS）
- ✅ SwiftData 数据模型
- ✅ Mac 端基础 UI（左右分栏）
- ✅ iOS 端基础 UI（滑动卡片）
- ✅ 全局快捷键框架
- ✅ iCloud 同步配置

### 待办功能
1. 🎤 语音输入（快速录制转文字）
2. 🖼️ 图片/视频支持（拖入拖出）
3. 🔗 社交媒体链接智能提取
4. 🤖 AI 智能合并推荐
5. 📋 一键复制/拖拽导出

### 体验要求
- 稳定、流畅、易用
- 动效极好
- 超好审美
- 可以创新

---

## 2026-02-03 iOS 动效优化

### 完成内容
- ✅ **滑动动效升级** - 添加视差效果、3D 旋转、交互式弹簧动画
- ✅ **触觉反馈** - 滑动切换时轻微震动 (UIImpactFeedbackGenerator)
- ✅ **卡片视觉优化** - 三层阴影、连续圆角、微妙边框
- ✅ **键盘自适应** - 监听键盘事件，自动调整卡片布局
- ✅ **按钮交互** - 添加缩放按钮样式，更有触感

### 技术细节
**滑动动效：**
- 相邻卡片视差跟随 (parallaxFactor: 0.3)
- 当前卡片拖动时轻微缩小
- 相邻卡片随拖动渐进放大/上移
- 3D 旋转效果 (rotation3DEffect)

**触觉反馈：**
- 切换成功：`impactOccurred(intensity: 0.6)`
- 拖动未切换：`selectionChanged()`
- 按钮点击：`impactOccurred(intensity: 0.5)`

**卡片阴影：**
```swift
.shadow(color: .black.opacity(0.03), radius: 1, y: 1)   // 紧贴
.shadow(color: .black.opacity(0.05), radius: 8, y: 4)   // 中层
.shadow(color: .black.opacity(0.08), radius: 24, y: 12) // 远层
```

### 编译状态
✅ BUILD SUCCEEDED (iPhone 16 Simulator)

---

## 2026-02-03 Mac 端动效与快捷键优化

### 完成内容
- ✅ **全局快捷键 ⌘⇧J** - 正常呼出/收起窗口
- ✅ **Esc 键收起窗口** - 编辑时按 Esc 快速隐藏
- ✅ **窗口动效优化** - 弹出/收起时带缩放+淡入淡出动画
- ✅ **VSCode 风格快捷键** - 完整实现

### VSCode 快捷键列表
| 快捷键 | 功能 |
|--------|------|
| ⌘D | 选中下一个相同词（多光标） |
| ⌥↑ | 向上移动当前行 |
| ⌥↓ | 向下移动当前行 |
| ⌘⇧K | 删除整行 |
| ⌘Enter | 在下方插入新行 |
| ⌘⇧Enter | 在上方插入新行 |
| ⌘L | 选中当前行 |
| ⌘⇧D | 复制当前行 |
| ⌘/ | 切换注释 |
| Esc | 收起窗口 |

### 技术细节
**窗口动效：**
- 弹出：从 96% 缩放 + 透明 → 100% + 不透明 (0.25s easeOut)
- 收起：100% → 96% 缩放 + 淡出 (0.2s easeIn)
- 窗口配置：浮动层级、跨空间显示

**编辑器增强：**
- 自定义 `VSCodeTextView` 继承 `NSTextView`
- 重写 `keyDown(with:)` 拦截快捷键
- 支持多光标选择（⌘D 连续选中）
- 完整 Undo/Redo 支持

### 编译状态
✅ BUILD SUCCEEDED (macOS)

---

---

## 2026-02-04 iOS 语音输入功能

### 完成内容
- ✅ **麦克风按钮** - 卡片顶部工具栏新增语音输入按钮
- ✅ **一键录音** - 点击开始，再点击停止
- ✅ **iOS 原生 Speech 框架** - 支持中英文语音识别
- ✅ **自动追加** - 转写结果自动追加到笔记内容
- ✅ **视觉反馈** - 录音时按钮变红 + 脉冲动画

### 新增文件
- `SpeechRecognizer.swift` - 语音识别管理器

### 技术细节
**权限配置 (project.yml)：**
```yaml
INFOPLIST_KEY_NSMicrophoneUsageDescription: "JotJot 需要麦克风权限来录制语音并转换为文字"
INFOPLIST_KEY_NSSpeechRecognitionUsageDescription: "JotJot 需要语音识别权限来将您的语音转换为文字"
```

**语音识别特性：**
- 优先使用设备端识别（更快、更隐私）
- 支持实时转写（partialResults）
- 自动停止（识别完成后）
- 中文优先，回退到系统语言

**UI 交互：**
- 按钮图标：`mic` / `mic.fill`
- 录音状态：红色 + `.symbolEffect(.pulse)`
- 触觉反馈：点击时震动

### 编译状态
✅ BUILD SUCCEEDED (iPhone 16 Simulator)

---

## 下一步
1. ~~打磨动效细节~~ ✅
2. ~~完善快捷键体验~~ ✅
3. ~~语音输入~~ ✅
4. ~~设计图标~~ ✅
5. ~~做官网~~ ✅

---

## 2026-02-04 官网上线

### 完成内容
- ✅ **深色主题** - 与 App 风格一致的高级感
- ✅ **品牌渐变色** - 靛蓝 → 紫罗兰 → 琥珀橙
- ✅ **Hero 区域** - App Preview 窗口展示
- ✅ **功能介绍** - 6 个核心功能卡片
- ✅ **双平台展示** - Mac / iOS 各自特色
- ✅ **下载区域** - CTA 按钮

### 设计语言
与 App 保持一致：
- 28px 连续圆角
- 三层阴影系统
- 弹簧动画
- 品牌渐变色

### 文件位置
`website/index.html` + `website/styles.css`

---

## 待办功能
1. ~~🖼️ 图片/视频支持（拖入拖出）~~ ✅
2. ~~🔗 社交媒体链接智能提取~~ ✅ (链接预览)
3. ~~🤖 AI 智能合并推荐~~ ✅
4. ~~📋 一键复制/拖拽导出~~ ✅ (分享功能)

---

## 2026-02-04 图片视频支持 + 双端对齐

### 完成内容
- ✅ **图片/视频支持** - 相册选择、拖拽导入导出
- ✅ **Mac 语音输入** - 与 iOS 功能对齐
- ✅ **双端设计统一** - 动画参数、圆角、尺寸
- ✅ **空状态对齐** - 统一文案和按钮样式
- ✅ **列表行对齐** - 统一预览和时间戳样式
- ✅ **菜单栏修复** - 点击笔记可跳转

### 双端功能对照
| 功能 | iOS | Mac |
|------|-----|-----|
| 图片/视频 | ✅ | ✅ |
| 语音输入 | ✅ | ✅ |
| 拖拽导入 | ✅ | ✅ |
| 拖拽导出 | ✅ | ✅ |
| 固定笔记 | ✅ | ✅ |
| iCloud 同步 | ✅ | ✅ |

### 编译状态
✅ iOS BUILD SUCCEEDED
✅ Mac BUILD SUCCEEDED

---

## 2026-02-05 Markdown 实时渲染

### 完成内容
- ✅ **Markdown 编辑器** - 实时高亮渲染
- ✅ **标题** - # ## ### 三级标题
- ✅ **粗体/斜体** - **bold** / *italic*
- ✅ **代码** - `inline code` 粉色+灰底
- ✅ **删除线** - ~~strikethrough~~
- ✅ **链接** - [text](url) 和纯 URL
- ✅ **任务列表** - [ ] / [x] 转换为 ☐/☑
- ✅ **引用块** - > quote 斜体灰色
- ✅ **内联图片** - ![](uuid) 格式

### 编译状态
✅ iOS BUILD SUCCEEDED

---

## 2026-02-05 链接预览功能

### 完成内容
- ✅ **链接自动检测** - NSDataDetector 检测 URL
- ✅ **OG 元数据提取** - og:title, og:description, og:image
- ✅ **预览卡片** - 显示标题、描述、缩略图
- ✅ **平台识别** - Twitter/微博/小红书/B站/知乎/GitHub

### 新增文件
- `LinkPreviewFetcher.swift` - 链接预览提取器
- `LinkPreviewCard.swift` - 预览卡片视图

### 编译状态
✅ iOS BUILD SUCCEEDED

---

## 2026-02-05 AI 智能合并推荐

### 完成内容
- ✅ **相似度分析** - 关键词重叠、标题相似、时间接近
- ✅ **合并推荐卡片** - 底部浮层显示推荐
- ✅ **一键合并** - 合并内容和媒体，删除重复笔记

### 新增文件
- `JotSimilarityAnalyzer.swift` - 相似度分析器
- `MergeSuggestionCard.swift` - 合并推荐卡片

### 编译状态
✅ iOS BUILD SUCCEEDED

### Mac 端同步更新
- ✅ Markdown 实时渲染
- ✅ 链接预览
- ✅ AI 合并推荐

### 双端功能对照（更新）
| 功能 | iOS | Mac |
|------|-----|-----|
| Markdown 渲染 | ✅ | ✅ |
| 链接预览 | ✅ | ✅ |
| AI 合并推荐 | ✅ | ✅ |
| 图片/视频 | ✅ | ✅ |
| 语音输入 | ✅ | ✅ |
| iCloud 同步 | ✅ | ✅ |

---

## 2026-02-05 深夜打磨

### 新增功能
- ✅ 搜索功能（双端）
- ✅ 分享功能（双端）
- ✅ iOS 字数统计

### 配置优化
- ✅ 统一 iOS/Mac iCloud container ID

### 编译状态
✅ iOS BUILD SUCCEEDED
✅ Mac BUILD SUCCEEDED

### 继续打磨
- ✅ App 图标（双端）
- ✅ 品牌色（双端）
- ✅ iCloud 配置统一
- ✅ 列表行动画效果

### 双端功能对照（最新）
| 功能 | iOS | Mac |
|------|-----|-----|
| Markdown 渲染 | ✅ | ✅ |
| 链接预览 | ✅ | ✅ |
| AI 合并推荐 | ✅ | ✅ |
| 搜索 | ✅ | ✅ |
| 分享 | ✅ | ✅ |
| 字数统计 | ✅ | ✅ |
| App 图标 | ✅ | ✅ |
| 品牌色 | ✅ | ✅ |
- ✅ 键盘快捷键 ⌘N（iOS iPad）
- ✅ 无障碍标签（iOS）

### 进度
JotJot 从 55% → 85%

---

## 2026-02-05 上午继续

### 新增功能
- ✅ iOS Widget 小组件
- ✅ iOS 启动动画

### App Store 准备
- ✅ 元数据（名称、描述、关键词）
- ✅ 隐私政策

### Dark Mode 优化
- ✅ 卡片背景改用 secondarySystemBackground
- ✅ 移除标题栏分割线

### 键盘快捷键
- ✅ iOS 方向键导航（iPad）
- ✅ Mac ⌘P 固定快捷键
- ✅ iOS ⌘P 固定快捷键
- ✅ iOS ⌘⌫ 删除快捷键
- ✅ Mac ⌘⌫ 删除快捷键
